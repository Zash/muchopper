{% extends "base.html" %}
{% set title = "Chat room index" %}
{% macro pagination() %}
<nav class="pagination">
    <ul>
    {%- if page.has_prev %}<li class="prev"><a href="{{ url_for('room_list', page=page.page-1) }}">Previous page</a>{% endif -%}
    {%- for pageno, insert_skip in visible_pages -%}
    {%- if insert_skip -%}
    <li>...</li>
    {%- endif -%}
    <li class="{{ 'current' if pageno == page.page else '' }}"><a href="{{ url_for('room_list', page=pageno) }}">{{ pageno }}</a></li>
    {%- endfor -%}
    {%- if page.has_next %}<li class="next"><a href="{{ url_for('room_list', page=page.page+1) }}">Next page</a>{% endif -%}
    </ul>
</nav>
{% endmacro %}
{% macro room_label(muc, public_info) %}
{% if public_info.name %}
{{ public_info.name }}
{% else %}
{% if muc.address.localpart %}
<span class="localpart">{{ muc.address.localpart }}</span><span class="at">@</span><span class="domain">{{ muc.address.domain }}</span>
{% else %}
{{ muc.address }}
{% endif %}
{% endif %}
{% endmacro %}
{% macro closed_marker() %}
{{ 'â€¯ ' }}<span class="closed-marker" title="This room requires a password or invitation.">ðŸ”’</span>
{% endmacro %}
{% block content %}
{{ pagination() }}
<table>
    <colgroup>
        <col class="label"/>
        <col class="nusers"/>
    </colgroup>
    <thead>
        <tr>
            <th>Address &amp; Description</th>
            <th>Online users</th>
        </tr>
    </thead>
    <tbody>
        {% for muc, public_info in page.items %}
        <tr>
            <td class="addr-descr">
                <div class="addr"><a href="xmpp:{{ muc.address }}?join">{{ room_label(muc, public_info) }}</a>{% if not muc.is_open %}{{ closed_marker() }}{% endif %}</div>
                {% set descr = public_info.description or public_info.subject %}
                {% if descr %}
                <div class="descr">{{ descr }}</div>
                {% endif %}
            </td>
            <td class="nusers">{{ muc.nusers }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{{ pagination() }}
{% endblock %}
